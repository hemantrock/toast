+function(n){EditableSelect=function(t,i){var r=this;this.options=i;this.$select=n(t);this.$input=n('<input type="text" autocomplete="off">');this.$list=n('<ul class="es-list">');this.utility=new EditableSelectUtility(this);["default","fade","slide"].indexOf(this.options.effects)<0&&(this.options.effects="default");(isNaN(this.options.duration)||["fast","slow"].indexOf(this.options.duration)<0)&&(this.options.duration="fast");this.$select.replaceWith(this.$input);this.$list.appendTo(this.options.appendTo||this.$input.parent());this.utility.initialize();this.utility.initializeList();this.utility.initializeInput();this.utility.trigger("created")};EditableSelect.DEFAULTS={filter:!0,effects:"default",duration:"fast"};EditableSelect.prototype.filter=function(){var t=0,i=this.$input.val().toLowerCase().trim();this.$list.find("li").addClass("es-visible").show();this.options.filter&&(t=this.$list.find("li").filter(function(t,r){return n(r).text().toLowerCase().indexOf(i)<0}).hide().removeClass("es-visible").length,this.$list.find("li").length==t&&this.hide())};EditableSelect.prototype.show=function(){if(this.$list.css({top:this.$input.position().top+this.$input.outerHeight()-1,left:this.$input.position().left,width:this.$input.outerWidth()}),!this.$list.is(":visible")&&this.$list.find("li.es-visible").length>0){var t={"default":"show",fade:"fadeIn",slide:"slideDown"}[this.options.effects];this.utility.trigger("show");this.$input.addClass("open");this.$list[t](this.options.duration,n.proxy(this.utility.trigger,this.utility,"shown"))}};EditableSelect.prototype.hide=function(){var t={"default":"hide",fade:"fadeOut",slide:"slideUp"}[this.options.effects];this.utility.trigger("hide");this.$input.removeClass("open");this.$list[t](this.options.duration,n.proxy(this.utility.trigger,this.utility,"hidden"))};EditableSelect.prototype.select=function(n){this.$list.has(n)&&n.is("li.es-visible")&&(this.$input.val(n.text()),this.hide(),this.filter(),this.utility.trigger("select",n))};EditableSelect.prototype.add=function(t,i,r,u){var f=n("<li>").html(t),e=n("<option>").text(t),o=this.$list.find("li").length;i=isNaN(i)?o:Math.min(Math.max(0,i),o);i==0?(this.$list.prepend(f),this.$select.prepend(e)):(this.$list.find("li").eq(i-1).after(f),this.$select.find("option").eq(i-1).after(e));this.utility.setAttributes(f,r,u);this.utility.setAttributes(e,r,u);this.filter()};EditableSelect.prototype.remove=function(n){var t=this.$list.find("li").length;n=isNaN(n)?t:Math.min(Math.max(0,n),t-1);this.$list.find("li").eq(n).remove();this.$select.find("option").eq(n).remove();this.filter()};EditableSelect.prototype.destroy=function(){this.$list.off("mousemove click mouseenter");this.$input.off("focus blur input keydown");this.$input.replaceWith(this.$select);this.$list.remove();this.$select.removeData("editable-select")};EditableSelectUtility=function(n){this.es=n};EditableSelectUtility.prototype.initialize=function(){var t=this;t.setAttributes(t.es.$input,t.es.$select[0].attributes,t.es.$select.data());t.es.$input.addClass("es-input").data("editable-select",t.es);t.es.$select.find("option").each(function(i,r){var u=n(r).remove();t.es.add(u.text(),i,r.attributes,u.data());u.attr("selected")&&t.es.$input.val(u.text())});t.es.filter()};EditableSelectUtility.prototype.initializeList=function(){var t=this;t.es.$list.on("mousemove","li",function(){t.es.$list.find(".selected").removeClass("selected");n(this).addClass("selected")}).on("click","li",function(){t.es.select(n(this))}).on("mouseenter",function(){t.es.$list.find("li.selected").removeClass("selected")})};EditableSelectUtility.prototype.initializeInput=function(){var t=this;t.es.$input.on("focus",n.proxy(t.es.show,t.es)).on("blur",n.proxy(t.es.hide,t.es)).on("input keydown",function(n){var i,r;switch(n.keyCode){case 38:i=t.es.$list.find("li.es-visible");r=i.index(i.filter("li.selected"))||0;t.highlight(r-1);break;case 40:i=t.es.$list.find("li.es-visible");r=i.index(i.filter("li.selected"))||0;t.highlight(r+1);break;case 13:t.es.$list.is(":visible")&&(t.es.select(t.es.$list.find("li.selected")),n.preventDefault());case 9:case 27:t.es.hide();break;default:t.es.filter();t.highlight(0)}})};EditableSelectUtility.prototype.highlight=function(n){var t=this;t.es.show();setTimeout(function(){var i=t.es.$list.find("li.es-visible"),o=t.es.$list.find("li.selected").removeClass("selected"),e=i.index(o);if(i.length>0){var f=(i.length+n)%i.length,r=i.eq(f),u=r.position().top;r.addClass("selected");f<e&&u<0&&t.es.$list.scrollTop(t.es.$list.scrollTop()+u);f>e&&u+r.outerHeight()>t.es.$list.outerHeight()&&t.es.$list.scrollTop(t.es.$list.scrollTop()+r.outerHeight()+2*(u-t.es.$list.outerHeight()))}})};EditableSelectUtility.prototype.setAttributes=function(t,i,r){n.each(i||{},function(n,i){t.attr(i.name,i.value)});t.data(r)};EditableSelectUtility.prototype.trigger=function(n){var i=Array.prototype.slice.call(arguments,1),t=[n+".editable-select"];t.push(i);this.es.$select.trigger.apply(this.es.$select,t);this.es.$input.trigger.apply(this.es.$input,t)};Plugin=function(t){var i=Array.prototype.slice.call(arguments,1);return this.each(function(){var u=n(this),r=u.data("editable-select"),f=n.extend({},EditableSelect.DEFAULTS,u.data(),typeof t=="object"&&t);r||(r=new EditableSelect(this,f));typeof t=="string"&&r[t].apply(r,i)})};n.fn.editableSelect=Plugin;n.fn.editableSelect.Constructor=EditableSelect}(jQuery);